<h1>TextBus 中文指南</h1>
<p>本文介绍了 TextBus 设计理念及各种概念，以及它们之间的关联关系，以帮助你能快的对 TextBus 有一个整体的了解，可以更轻松的使用 TextBus 的各种功能。</p>
<h2>简介</h2>
<p>&nbsp;&nbsp;TextBus 并不是一个一体化的编辑器，而是提供了成套的技术方案，旨在解决富文本开发中容易掉入各种样式、标签及光标计算的陷阱。使用 TextBus，你基本无需再关心标签如何嵌套，光标位置保持的问题，也不必关心编辑内容生成的代码质量问题。</p>
<p>&nbsp;&nbsp;TextBus 通过抽象的组件（Component）、内容（Content）和格式（formatter）组成基本数据结构，你完全掌控这些数据的变化，你也完全可以预期这些数据的渲染结果。同时，得益于 TextBus 高效的渲染器（Renderer），对于超长文档，或者复杂组件，你总是能得到几乎 1ms 内的视图更新效率，同时生成最干净的富文本内容。你也可以像平常使用前端开发框架一样，在组件内添加事件监听，并做出优秀交互效果。还可以根据不同的渲染上下文，在编辑时和输出时，生成不一样的富文本内容。甚至，你可以生成 Vue 或 Angular 的模板代码，作为低代码平台的源数据。</p>
<p>总之，限制你的是你的想象力！</p>
<p>TextBus 目前有三个模块，它们分别是：</p>
<ul>
  <li><strong>core</strong>&nbsp;<span style="color:#1296db">核心模块</span>，提供了 TextBus 文档的基本数据模型、操作、渲染，以及状态查询、选区、数据转换、历史记录等；</li>
  <li><strong>browser</strong>&nbsp;<span style="color:#1296db">浏览器支持模块</span>，提供了 PC 端编辑器的视图层，如选区、HTML 解析、光标及文本输入等；</li>
  <li><strong>editor</strong>&nbsp;TextBus 官方实现的 PC 端富文本编辑器，提供了大多数富文本所需的功能。</li>
</ul>
<h2>基本概念</h2>
<p>数据结构：</p>
<ul>
  <li><strong>Component</strong>&nbsp;<span style="color:#1296db">组件</span>&nbsp;和前端框架一样，组件是由特定的结构和交互的代码块，组件内也可以有零到多个 slot（插槽），组件也可以有自己的方法，来完成自身的数据交互；</li>
  <li><strong>Slot</strong>&nbsp;<span style="color:#1296db">插槽</span>&nbsp;表示组件内可以动态插入内容的位置，在 TextBus 中，表示这一块的内容是可以编辑的，用户可以通过操作来修改里面的内容；</li>
  <li><strong>Formatter</strong>&nbsp;<span style="color:#1296db">格式</span>&nbsp;表示对文本的修饰，如加粗、字体颜色等；</li>
  <li><strong>ContentType</strong>&nbsp;<span style="color:#1296db">内容类型</span>&nbsp;分别为：BlockComponent（块组件）、InlineComponent（行内组件）、Text（文本）；</li>
  <li><strong>VElement</strong>&nbsp;<span style="color:#1296db">虚拟无素节点</span>&nbsp;TextBus 渲染组件或格式时，虚拟 DOM 树元素节点；</li>
  <li><strong>VTextNode</strong>&nbsp;<span style="color:#1296db">虚拟文本节点</span>&nbsp;TextBus 渲染文本时，虚拟 DOM 树文本节点。</li>
</ul>
<p>数据操作：</p>
<ul>
  <li><strong>Commander</strong>&nbsp;<span style="color:#1296db">命令</span>&nbsp;对文档进行修改操作的简洁方法；</li>
  <li><strong>TBSelection</strong>&nbsp;<span style="color:#1296db">选区</span>&nbsp;当前选择的区域（大多数情况为用户拖蓝的区域）；</li>
  <li><strong>Query</strong>&nbsp;<span style="color:#1296db">查询</span>&nbsp;根据组件或格式查询在文档选区的中状态；</li>
  <li><strong>Renderer</strong>&nbsp;<span style="color:#1296db">渲染器</span>&nbsp;用于渲染文档的核心类，可通过渲染器获取到直实 ；DOM 节点，虚拟 DOM 节点，以及数据之间的映射关系；</li>
  <li><strong>Hist​ory</strong>&nbsp;<span style="color:#1296db">历史记录</span>&nbsp;用于记录用户操作，并提供前进，后退操作；</li>
  <li><strong>Translator</strong>&nbsp;<span style="color:#1296db">数据转换器</span>&nbsp;用于把 JSON 数据转换为 TextBus 数据结构的工具类。</li>
</ul>
<p>可以把 TextBus 简单理解为：组件提供了你在富文本内创建布局、用户交互和受控渲染的能力，插槽提供了让用户编辑的能力。</p>
<h2>安装</h2><pre lang=""><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line">npm install @textbus/editor @textbus/core @textbus/browser</span></span></pre>
<h2>使用默认配置</h2><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ createEditor }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/editor'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;editor =&nbsp;<span class="tb-hl-function">createEditor</span>(document.<span class="tb-hl-function">getElementById</span>(<span class="tb-hl-string">'editor'</span>))</span><span class="tb-code-line"><br></span><span class="tb-code-line">editor.onChange.<span class="tb-hl-function">subscribe</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;content = editor.<span class="tb-hl-function">getContent</span>()</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-builtin">console</span>.<span class="tb-hl-function">log</span>(content)</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h2>创建自定义编辑器</h2>
<p>在 html 中准备好一个容器。</p><pre lang="HTML"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line">&lt;<span class="tb-hl-tag">div&nbsp;</span><span class="tb-hl-attr-name">id</span>="<span class="tb-hl-attr-value">editor</span>"&gt;&lt;/<span class="tb-hl-tag">div</span>&gt;</span></span><span class="tb-pre-lang">HTML</span></pre>
<p>导入 Editor 类，并实例化。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ Editor }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/editor'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;editor =&nbsp;<span class="tb-hl-keyword">new</span>&nbsp;<span class="tb-hl-class-name">Editor</span>(<span class="tb-hl-string">'#editor'</span>)</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<p>至此，我们就创建了一个只有少量功能的基础的编辑器。</p>
<blockquote>
  <p>之所以说有少量功能，是因为 Editor 默认包含了根组件，根组件内有引用段落组件，从而让你有最基本的文字及段落编辑能力，这是 @textbus/editor 这个包中封装好的能力。</p>
  <p>如果你想完全自定义编辑器的行为，则可以引用 @textbus/browser 中的 CoreEditor 类来创建编辑器。或者在实例化 Editor 时，在配置项中传入根组件。</p>
</blockquote>
<h3>添加格式支持</h3>
<p>在上面创建的编辑器内，我们只有简单的文字编辑功能。如果我们想要加粗一段文字，则需要创建 Formatter。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ FormatType, VElement }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;boldFormatter = {</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">// 设置 boldFormatter 是一个行内标签样式</span></span><span class="tb-code-line">&nbsp;&nbsp;type: FormatType.InlineTag,</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">// 设置 Formatter 名字为 `bold`</span></span><span class="tb-code-line">&nbsp;&nbsp;name:&nbsp;<span class="tb-hl-string">'bold'</span>,</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">// 当 boldFormatter 渲染时，我们返回一个 strong 标签的虚拟 DOM 节点</span></span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">render</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;<span class="tb-hl-keyword">new</span>&nbsp;<span class="tb-hl-class-name">VElement</span>(<span class="tb-hl-string">'strong'</span>)</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">}</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<p>我们还需要创建一个 loader，让 TextBus 能在 HTML 中识别出加粗的格式。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">export</span>&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;boldFormatLoader = {</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">// 当匹配到一个 DOM 元素的标签为 `strong`、`b` 或者当前元素的样式的 fontWeight 为 500 ~ 900 或者 bold 时，返回 true</span></span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">match</span>(element) {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;[<span class="tb-hl-string">'strong'</span>,&nbsp;<span class="tb-hl-string">'b'</span>].<span class="tb-hl-function">includes</span>(element.tagName.<span class="tb-hl-function">toLowerCase</span>()) ||</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tb-hl-string">'bold'</span>,&nbsp;<span class="tb-hl-string">'500'</span>,&nbsp;<span class="tb-hl-string">'600'</span>,&nbsp;<span class="tb-hl-string">'700'</span>,&nbsp;<span class="tb-hl-string">'800'</span>,&nbsp;<span class="tb-hl-string">'900'</span>].<span class="tb-hl-function">includes</span>(element.style.fontWeight)</span><span class="tb-code-line">&nbsp;&nbsp;},</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">// 当元素匹配成功时，会调用 read 方法获取样式的值，由于加粗只有生效和不生效两种，所以，我们可以用一个 boolean 值来表示，这里可以返回 true 即可</span></span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">read</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;<span class="tb-hl-boolean">true</span></span><span class="tb-code-line">&nbsp;&nbsp;},</span><span class="tb-code-line">&nbsp;&nbsp;formatter: boldFormatter</span><span class="tb-code-line">}</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<p>现在，我们可以把我们创建好的 Formatter 添加到编辑器中了。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ Editor }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/editor'</span></span><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ boldFormatLoader }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'./bold-formatter'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;editor =&nbsp;<span class="tb-hl-keyword">new</span>&nbsp;<span class="tb-hl-class-name">Editor</span>(<span class="tb-hl-string">'#editor'</span>, {</span><span class="tb-code-line">&nbsp;&nbsp;formatLoaders: [</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;boldFormatLoader</span><span class="tb-code-line">&nbsp;&nbsp;]</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<p>至此，我们的编辑器就可以支持加粗文字的功能了。</p>
<p>等等，我们虽然添加了 boldFormatter，但并没有一个工具去触发，让它在编辑器内动态添加上去。让我们在页面添加一个按钮，当用户点击的时候，就让编辑器内的文字加粗。</p><pre lang="HTML"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line">&lt;<span class="tb-hl-tag">div&nbsp;</span><span class="tb-hl-attr-name">class</span>="<span class="tb-hl-attr-value">toolbar</span>"&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&lt;<span class="tb-hl-tag">button&nbsp;</span><span class="tb-hl-attr-name">type</span>="<span class="tb-hl-attr-value">button</span>"<span class="tb-hl-tag">&nbsp;</span><span class="tb-hl-attr-name">id</span>="<span class="tb-hl-attr-value">bold-btn</span>"&gt;加粗&lt;/<span class="tb-hl-tag">button</span>&gt;</span><span class="tb-code-line">&lt;/<span class="tb-hl-tag">div</span>&gt;</span><span class="tb-code-line">&lt;<span class="tb-hl-tag">div&nbsp;</span><span class="tb-hl-attr-name">id</span>="<span class="tb-hl-attr-value">editor</span>"&gt;&lt;/<span class="tb-hl-tag">div</span>&gt;</span></span><span class="tb-pre-lang">HTML</span></pre><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ Commander }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span></span><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ boldFormatLoader }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'./bold-formatter'</span></span><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ boldFormatter }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'./inline-tag.formatter'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;boldBtn = document.<span class="tb-hl-function">getElementById</span>(<span class="tb-hl-string">'bold-btn'</span>)</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-comment">// 当编辑器准备好时，我们再添加功能</span></span><span class="tb-code-line">editor.onReady.<span class="tb-hl-function">subscribe</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;injector = editor.injector</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;commander = injector.<span class="tb-hl-function">get</span>(Commander)</span><span class="tb-code-line">&nbsp;&nbsp;boldBtn.<span class="tb-hl-function">addEventListener</span>(<span class="tb-hl-string">'click'</span>, () =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;commander.<span class="tb-hl-function">applyFormat</span>(boldFormatter,&nbsp;<span class="tb-hl-boolean">true</span>)</span><span class="tb-code-line">&nbsp;&nbsp;})</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<p>现在，我们框选一段文字并点击加粗按钮时，你就会看到文字已经加粗了，如果，光标是闭合的，TextBus 也会智能加粗后面输入的文字。</p>
<p>在实际的应用中，仅仅文字加粗是不满足需求的，我们更希望如果已经加粗了，则取消加粗。这时，则需要状态查询来帮助我们完成相应的功能。让我们继续完善上面的功能。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ Commander, Query, QueryStateType }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span></span><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ boldFormatLoader }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'./bold-formatter'</span></span><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ boldFormatter }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'./inline-tag.formatter'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;boldBtn = document.<span class="tb-hl-function">getElementById</span>(<span class="tb-hl-string">'bold-btn'</span>)</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-comment">// 当编辑器准备好时，我们再添加功能</span></span><span class="tb-code-line">editor.onReady.<span class="tb-hl-function">subscribe</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;injector = editor.injector</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;commander = injector.<span class="tb-hl-function">get</span>(Commander)</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;query = injector.<span class="tb-hl-function">get</span>(Query)</span><span class="tb-code-line">&nbsp;&nbsp;boldBtn.<span class="tb-hl-function">addEventListener</span>(<span class="tb-hl-string">'click'</span>, () =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 通过 Query，查询当前光标所在范围是否已加粗</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;queryState = query.<span class="tb-hl-function">queryFormat</span>(boldFormatter)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;isBold = queryState.state === QueryStateType.Enabled</span><span class="tb-code-line"><br></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 如果已加粗，我们则取消应用加粗效果，否则就加粗</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">if</span>&nbsp;(isBold) {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commander.<span class="tb-hl-function">unApplyFormat</span>(boldFormatter)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="tb-hl-keyword">else</span>&nbsp;{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commander.<span class="tb-hl-function">applyFormat</span>(boldFormatter,&nbsp;<span class="tb-hl-boolean">true</span>)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;})</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<p>现在我们可以根据查询状态，分别设置应用或取消应用样式了，我们还需要实时监听编辑器内容的变化，让按钮呈现高亮的效果，给用户更好的反馈。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ Commander, Query, QueryStateType, Renderer }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span></span><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ boldFormatLoader }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'./bold-formatter'</span></span><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ boldFormatter }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'./inline-tag.formatter'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;boldBtn = document.<span class="tb-hl-function">getElementById</span>(<span class="tb-hl-string">'bold-btn'</span>)</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-comment">// 当编辑器准备好时，我们再添加功能</span></span><span class="tb-code-line">editor.onReady.<span class="tb-hl-function">subscribe</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;injector = editor.injector</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;commander = injector.<span class="tb-hl-function">get</span>(Commander)</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;query = injector.<span class="tb-hl-function">get</span>(Query)</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;renderer = injector.<span class="tb-hl-function">get</span>(Renderer)</span><span class="tb-code-line"><br></span><span class="tb-code-line">&nbsp;&nbsp;renderer.onViewChecked.<span class="tb-hl-function">subscribe</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;queryState = query.<span class="tb-hl-function">queryFormat</span>(boldFormatter)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;isBold = queryState.state === QueryStateType.Enabled</span><span class="tb-code-line"><br></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 根据编辑器实时状态，高亮显示按钮</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">if</span>&nbsp;(isBold) {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boldBtn.classList.<span class="tb-hl-function">add</span>(<span class="tb-hl-string">'active'</span>)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="tb-hl-keyword">else</span>&nbsp;{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boldBtn.classList.<span class="tb-hl-function">remove</span>(<span class="tb-hl-string">'active'</span>)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;boldBtn.<span class="tb-hl-function">addEventListener</span>(<span class="tb-hl-string">'click'</span>, () =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 通过 Query，查询当前光标所在范围是否已加粗</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;queryState = query.<span class="tb-hl-function">queryFormat</span>(boldFormatter)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;isBold = queryState.state === QueryStateType.Enabled</span><span class="tb-code-line"><br></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 如果已加粗，我们则取消应用加粗效果，否则就加粗</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">if</span>&nbsp;(isBold) {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commander.<span class="tb-hl-function">unApplyFormat</span>(boldFormatter)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="tb-hl-keyword">else</span>&nbsp;{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commander.<span class="tb-hl-function">applyFormat</span>(boldFormatter,&nbsp;<span class="tb-hl-boolean">true</span>)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;})</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<p>至此，我们的加粗工具，就基本完成了。</p>
<h3>添加组件</h3>
<p>和前端框架一样，组件是指带有特定交互行为或结构的一个单独功能模块。要创建一个组件，只需要调用 defineComponent 函数，并编写特定的配置项即可。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ defineComponent, ContentType, useSlots, Slot }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">export</span>&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;myComponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;type: ContentType.BlockComponent,&nbsp;<span class="tb-hl-comment">// 设置组件类型</span></span><span class="tb-code-line">&nbsp;&nbsp;name:&nbsp;<span class="tb-hl-string">'MyComponent'</span>, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 组件的名字，不可重复</span></span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">transform</span>(translator, state) { &nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 将当前组件 json 数据转换为实例</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;translator.<span class="tb-hl-function">createSlot</span>(state)</span><span class="tb-code-line">&nbsp;&nbsp;},</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>(slot) {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 组件的具体逻辑</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;slots =&nbsp;<span class="tb-hl-function">useSlots</span>(slot ||&nbsp;<span class="tb-hl-keyword">new</span>&nbsp;<span class="tb-hl-class-name">Slot</span>([</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentType.Text</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;]))</span><span class="tb-code-line"><br></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">render</span>(isOutputMode, slotRender) {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;(</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;my-component&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">slotRender</span>(slots.<span class="tb-hl-function">get</span>(<span class="tb-hl-number">0</span>), () =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;&lt;div/&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/my-component&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">toJSON</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slots.<span class="tb-hl-function">get</span>(<span class="tb-hl-number">0</span>).<span class="tb-hl-function">toJSON</span>()</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<p>上面示例是一个最简单的组件，但它基本包含了 TextBus 组件的基本形态，更复杂的组件，无非是在这个基础上增加更多的逻辑而已。</p>
<p>&nbsp;&nbsp;为了让 TextBus 能从 HTML 中识别出组件，我们还需要创建组件加载器。加载器用于从文档中识别并读取出组件的必要信息，从而生成 TextBus 的组件实例的工具类，由于 TextBus 是跨平台的，所以不同平台的加载器也可能是不同的，我们以 PC 平台为例。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ Slot, ContentType }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">export</span>&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;myComponentLoader = {</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">// 设置组件的根元素为块级样式</span></span><span class="tb-code-line">&nbsp;&nbsp;reources: {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;styles: [<span class="tb-hl-string">'my-component{display:block}'</span>]</span><span class="tb-code-line">&nbsp;&nbsp;},</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">match</span>(element) {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 匹配一个 DOM 元素，返回 true 即表示为当前组件</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;element.tagName.<span class="tb-hl-function">toLowerCase</span>() ===&nbsp;<span class="tb-hl-string">'my-component'</span></span><span class="tb-code-line">&nbsp;&nbsp;},</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">read</span>(element, injector, slotParser) {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 读取当前 DOM 元素下组件指定的结构，并返回组件实例</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;slot =&nbsp;<span class="tb-hl-function">slotParser</span>(<span class="tb-hl-keyword">new</span>&nbsp;<span class="tb-hl-class-name">Slot</span>([</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentType.Text</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;]), element.children[<span class="tb-hl-number">0</span>])</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;paragraphComponent.<span class="tb-hl-function">createInstance</span>(injector, slot)</span><span class="tb-code-line">&nbsp;&nbsp;},</span><span class="tb-code-line">&nbsp;&nbsp;component: myComponent</span><span class="tb-code-line">}</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<p>现在我们在编辑器中添加我们刚创建的组件。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;editor =&nbsp;<span class="tb-hl-keyword">new</span>&nbsp;<span class="tb-hl-class-name">Editor</span>(<span class="tb-hl-string">'#editor'</span>, {</span><span class="tb-code-line">&nbsp;&nbsp;componentLoaders: [</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;myComponentLoader</span><span class="tb-code-line">&nbsp;&nbsp;]</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<p>我们也可以继续添加一个按钮，点击按钮可以往文档中插入 MyComponent 组件。</p><pre lang="HTML"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line">&lt;<span class="tb-hl-tag">div&nbsp;</span><span class="tb-hl-attr-name">class</span>="<span class="tb-hl-attr-value">toolbar</span>"&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&lt;<span class="tb-hl-tag">button&nbsp;</span><span class="tb-hl-attr-name">type</span>="<span class="tb-hl-attr-value">button</span>"<span class="tb-hl-tag">&nbsp;</span><span class="tb-hl-attr-name">id</span>="<span class="tb-hl-attr-value">bold-btn</span>"&gt;加粗&lt;/<span class="tb-hl-tag">button</span>&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&lt;<span class="tb-hl-tag">button&nbsp;</span><span class="tb-hl-attr-name">type</span>="<span class="tb-hl-attr-value">button</span>"<span class="tb-hl-tag">&nbsp;</span><span class="tb-hl-attr-name">id</span>="<span class="tb-hl-attr-value">insert-my-component</span>"&gt;插入MyComponent&lt;/<span class="tb-hl-tag">button</span>&gt;</span><span class="tb-code-line">&lt;/<span class="tb-hl-tag">div</span>&gt;</span><span class="tb-code-line">&lt;<span class="tb-hl-tag">div&nbsp;</span><span class="tb-hl-attr-name">id</span>="<span class="tb-hl-attr-value">editor</span>"&gt;&lt;/<span class="tb-hl-tag">div</span>&gt;</span></span><span class="tb-pre-lang">HTML</span></pre><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ Commander, ContentType }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ myComponent }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'./my-component'</span></span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;insertBtn = document.<span class="tb-hl-function">getElementById</span>(<span class="tb-hl-string">'insert-my-component'</span>)</span><span class="tb-code-line"><br></span><span class="tb-code-line">editor.onReady.<span class="tb-hl-function">subscribe</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;injector = editor.injector</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;commander = injector.<span class="tb-hl-function">get</span>(Commander)</span><span class="tb-code-line"><br></span><span class="tb-code-line">&nbsp;&nbsp;insertBtn.<span class="tb-hl-function">addEventListener</span>(<span class="tb-hl-string">'click'</span>, () =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;componentInstance = myComponent.<span class="tb-hl-function">createInstance</span>()</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;commander.<span class="tb-hl-function">insert</span>(componentInstance)</span><span class="tb-code-line">&nbsp;&nbsp;})</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h2>数据交互</h2>
<p>本章节主要介绍在组件 setup 函数内可以调用的一些勾子函数。</p>
<h3>useContext</h3>
<p>返回当前编辑器的注入器，通过注入器，可以获取到编辑器内部各个类的实例</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ useContext, Commander, defineComponent }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 获取注入器</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;injector =&nbsp;<span class="tb-hl-function">useContext</span>()</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 获取编辑器内部类实例</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;commander = injector.<span class="tb-hl-function">get</span>(Commander)</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>useSelf</h3>
<p>返回当前组件实例</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ useSelf }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;componentInstance =&nbsp;<span class="tb-hl-function">useSelf</span>()</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>useSlots</h3>
<p>把一组插槽挂载到文档，一个组件只允许调用一次。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ ContentType, useSlots }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;slots =&nbsp;<span class="tb-hl-function">useSLots</span>([</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">new</span>&nbsp;<span class="tb-hl-class-name">Slot</span>([</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentType.Text</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;], () =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 当内容恢复时，插槽还原的工厂函数</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;<span class="tb-hl-keyword">new</span>&nbsp;<span class="tb-hl-class-name">Slot</span>([</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentType.Text</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">render</span>(isOutputMode, slotRenderFn) {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;(</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">slotRenderFn</span>(slots.<span class="tb-hl-function">get</span>(<span class="tb-hl-number">0</span>), () =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;&lt;p/&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>useState</h3>
<p>当前组件的自定义状态，一个组件只能调用一次。</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ useState }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">let</span>&nbsp;state = {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;<span class="tb-hl-string">'100px'</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;stateController =&nbsp;<span class="tb-hl-function">useState</span>(state)</span><span class="tb-code-line"><br></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;state.onChange.<span class="tb-hl-function">subscribe</span>(newState =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state = newState</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">render</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;(</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;imgsrc=<span class="tb-hl-string">"./example.jpg"</span>width={state.width}/&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>useRef</h3>
<p>用于获取 DOM 实例</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ useRef, onViewInit }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;domRef =&nbsp;<span class="tb-hl-function">useRef</span>()</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onViewInit</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-builtin">console</span>.<span class="tb-hl-function">log</span>(domRef.current)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">render</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;(</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pref={domRef}&gt;我的组件&lt;/p&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>useRefs</h3>
<p>用于获取一组 DOM 实例，常用在循环中</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ useRefs, onViewInit }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;domRefs =&nbsp;<span class="tb-hl-function">useRefs</span>()</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onViewInit</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-builtin">console</span>.<span class="tb-hl-function">log</span>(domRefs)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">render</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;(</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pref={domRefs}&gt;我的组件&lt;/p&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pref={domRefs}&gt;我的组件&lt;/p&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>useDynamicShortcut</h3>
<p>组件内部快捷键，用于只在组件内生效的快捷键</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ useDynamicShortcut }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">useDynamicShortcut</span>({</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keymap: {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key:&nbsp;<span class="tb-hl-string">'Tab'</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">action</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-builtin">console</span>.<span class="tb-hl-function">log</span>(<span class="tb-hl-string">'Tab 快捷键触发了！'</span>)</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h2>生命周期</h2>
<h3>onPaste</h3>
<p>当组件插槽发生粘贴事件时调用</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ onPaste }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onPaste</span>(ev =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">//</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>onContextMenu</h3>
<p>当用户在组件内点击鼠标右键时调用</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ onContextMenu }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onContextMenu</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">return</span>&nbsp;[{</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label:&nbsp;<span class="tb-hl-string">'自定义上下文菜单'</span>,</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onClick</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">//</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}]</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>onViewChecked</h3>
<p>当组件每次视图更新完成后调用</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ onViewChecked }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onViewChecked</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">//</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>onViewInit</h3>
<p>当组件第一次视图渲染完成时调用</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ onViewInit }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onViewInit</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">//</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>onSlotRemove</h3>
<p>当用户触发组件插槽删除前调用</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ onSlotRemove }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onSlotRemove</span>(ev =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">//</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>onDelete</h3>
<p>当用户删除组件插槽内内容时调用</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ onDelete }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onDelete</span>(ev =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">//</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>onEnter</h3>
<p>当用户在组件插槽内按回车键时调用</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ onEnter }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onEnter</span>(ev =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">//</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>onInsert</h3>
<p>当用户在组件插槽内输入时调用</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ onInsert }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onInsert</span>(ev =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">//</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>onInserted</h3>
<p>当用户在组件插槽内输入完成时调用</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ onInserted }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onInserted</span>(ev =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">//</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>
<h3>onDestroy</h3>
<p>当组件销毁时调用</p><pre lang="TypeScript"><span style="width:2em" class="tb-code-line-number-bg"></span><span class="tb-code-content"><span class="tb-code-line"><span class="tb-hl-keyword">import</span>&nbsp;{ onDestroy }&nbsp;<span class="tb-hl-keyword">from</span>&nbsp;<span class="tb-hl-string">'@textbus/core'</span>;</span><span class="tb-code-line"><br></span><span class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;myCommponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</span><span class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-function">onDestroy</span>(() =&gt; {</span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">//</span></span><span class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><span class="tb-code-line">&nbsp;&nbsp;}</span><span class="tb-code-line">})</span></span><span class="tb-pre-lang">TypeScript</span></pre>